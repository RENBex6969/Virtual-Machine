local Roblox = require("@lune/roblox")
local Registry = require("@Dep/Registry")
local Vector2 = Roblox.Vector2
local Color3 = Roblox.Color3
local Library = {}

local SupportedTypes = {
  Line = true,
  Text = true,
  Image = true,
  Circle = true,
  Square = true,
  Quad = true,
  Triangle = true
}

Library.Fonts = {
  UI = 0,
  System = 1,
  Plex = 2,
  Monospace = 3
}

function Library.new(Type : string): userdata
  assert(type(Type) == "string", "argument #1 to be a string, got " .. type(Type))
  assert(SupportedTypes[Type], "Drawing.new: expected argument #1 to be a valid drawing type, got " .. Type)
  
  local Properties = {
    Visible = false,
    ZIndex = 1,
    Transparency = 1,
    Color = Color3.new(0, 0, 0),
    __OBJECT_EXISTS = true
  }
  
  function Properties:Destroy()
    Properties.__OBJECT_EXISTS = false
    Properties.Visible = false
  end
  
  if Type == "Line" then
    Properties.From = Vector2.new(0, 0)
    Properties.To = Vector2.new(0, 0)
    Properties.Thickness = 0
  end
  
  if Type == "Text" then
    Properties.Text = ""
    Properties.TextBounds = 0
    Properties.Font = 3
    Properties.Size = 0
    Properties.Position = Vector2.new(0, 0)
    Properties.Center = false
    Properties.Outline = false
    Properties.OutlineColor = Color3.new(0, 0, 0)
  end
  
  if Type == "Image" then
    Properties.Data = ""
    Properties.Size = Vector2.new(50, 50)
    Properties.Position = Vector2.new(0, 0)
    Properties.Rounding = 0
    Properties.Visible = true
  end
  
  if Type == "Circle" then
    Properties.NumSides = 0
    Properties.Radius = 1
    Properties.Position = Vector2.new(0, 0)
    Properties.Thickness = 1
    Properties.Filled = false
  end
  
  if Type == "Square" then
    Properties.Size = Vector2.new(0, 0)
    Properties.Position = Vector2.new(0, 0)
    Properties.Thickness = 0
    Properties.Filled = false
  end
  
  if Type == "Quad" then
    Properties.PointA = Vector2.new(0, 0)
    Properties.PointB = Vector2.new(0, 0)
    Properties.PointC = Vector2.new(0, 0)
    Properties.PointD = Vector2.new(0, 0)
    Properties.Thickness = 0
    Properties.Filled = false
  end
  
  if Type == "Triangle" then
    Properties.PointA = Vector2.new(0, 0)
    Properties.PointB = Vector2.new(0, 0)
    Properties.PointC = Vector2.new(0, 0)
    Properties.Thickness = 0
    Properties.Filled = false
  end
  
  local Proxy = newproxy(true)
  local MT = getmetatable(Proxy)
  
  MT.__index = function(_, Key)
    if Type == "Text" and Properties.TextBounds == 0 and Key == "TextBounds" then
      local Width = #Properties.Text * Properties.Size * 0.5
      
      return Vector2.new(Width, Properties.Size)
    end
    
    return Properties[Key]
  end

  MT.__newindex = function(_, Key, Value)
    assert(Properties.__OBJECT_EXISTS, Type .. ": object is destroyed cannot edit properties!", 2)
    
    if rawget(Properties, Key) == nil then
      error(Type .. ": cannot add new property '" .. tostring(Key) .. "'", 2)
    end
    
    rawset(Properties, Key, Value)
  end
  
  MT.__tostring = function()
    return "Drawing"
  end
  
  MT.__metatable = "Locked"
  
  table.insert(Registry.DrawingCache, Proxy)

  return Proxy
end

return Library