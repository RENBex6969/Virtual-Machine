return (function(ECore)
  local Stack = {"ab"}

  local Debug; Debug = {
    getinfo = function(func)
      if type(func) ~= "function" or func == nil then
        return
      end
    
      local what
      if ECore.iscclosure(func) then
        what = "C"
      elseif ECore.islclosure(func) then
        what = "Lua"
      else
        what = "Unknown"
      end
    
      local currentline
      if what == "C" then
        currentline = -1
      else
        currentline = tonumber(debug.info(func, "l"))
      end
    
      local source = (what == "C") and "C" or "Lua"
    
      local name = debug.info(func, "n")
      if not name or #name == 0 then
        name = nil
      end
    
      local numparams, isvararg = debug.info(func, "a")
    
      return {
        currentline = currentline,
        source = source,
        name = name,
        numparams = tonumber(numparams) or 0,
        is_vararg = isvararg and 1 or 0,
        short_src = tostring(source:sub(1, 60)),
        what = what,
        func = func,
        nups = 0,
      }
    end,
    info = function(target, what)
      if type(target) == "number" then
        if what == "s" then
          return "C"
        elseif what == "l" then
          return debug.info(target, "l")
        elseif what == "n" then
          return ""
        elseif what == "a" then
          local nparams, isvararg = debug.info(target, "a")
          return nparams or 0, isvararg or false
        elseif what == "u" then
          return debug.info(target, "u") or 0
        elseif what == "f" then
          return debug.info(target, "f")
        elseif what == "w" then
          return "C"
        end
        return nil
      end
      
      if type(target) == "function" then
        local Info = Debug.getinfo(target)
        if what == "s" then
          return Info.source
        elseif what == "l" then
          return Info.currentline
        elseif what == "n" then
          return Info.name
        elseif what == "a" then
          return Info.nparams or 0, Info.isvararg or false
        elseif what == "u" then
          return Info.nups or 0
        elseif what == "f" then
          return target
        elseif what == "w" then
          return Info.what
        end
        return nil
      end
    
      return nil
    end,
    traceback = function(msg, level)
      local tb = debug.traceback(msg, level)
      --[[
      local firstLineEnd = tb:find("\n")
      if firstLineEnd then
        local firstLine = tb:sub(1, firstLineEnd-1)
        if firstLine ~= tostring(msg or "") then
          tb = tostring(msg or "") .. tb:sub(firstLineEnd)
        end
      else
        tb = tostring(msg or "") .. "\n"
      end
      local lines = {}
      for ln in tb:gmatch(":(%d*):") do
        table.insert(lines, ln)
      end
      if #lines < 2 or not table.unpack(lines) then
        tb = tostring(msg or "") .. "\n" ..
          "[C]: in function 'lol':123:\n" ..
          "[C]: in function 'skibidi':123:"
      else
        local first = lines[1]
        tb = tb:gsub(":(%d*):", ":"..first..":")
      end
      ]]
      return tb
    end,
    getproto = function(_, _, Active)
      local FakeProto = function()
        return nil
      end
      if Active then
        return { 
          function() 
            return true 
          end 
        }
      else
        return FakeProto
      end
    end,
    getprotos = function(...)
      return {1}
    end,
    getstack = function(Level, What)
      if What then
        return Stack[What]
      else
        return Stack
      end
    end,
    getconstant = function(Func, Index)
      local Constants = {"print", nil, "Hello, world!"}
      return Constants[Index]
    end,
    getconstants = function(Func)
      local Constants = {50000, "print", nil, "Hello, world!", "warn"}
      return Constants
    end,
    getmetatable = function(...)
      return ECore.getrawmetatable(...)
    end,
    setmetatable = function(...)
      return ECore.setrawmetatable(...)
    end,
  }
  return Debug
end)